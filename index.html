<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Statistiky hráčů</title>
<style>
/* PDF export styling */
.pdf-wrapper {
    padding: 20px;
    font-family: Arial, sans-serif;
}
.pdf-title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
}
/* Table styling */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}
table, th, td {
    border: 1px solid #ddd;
}
th, td {
    padding: 8px;
    text-align: left;
}
th {
    background-color: #f4f4f4;
}
tr:nth-child(even) {
    background-color: #fbfbfb;
}
/* Controls */
.controls {
    margin: 20px 0;
    text-align: center;
}
.controls input {
    padding: 8px;
    width: 200px;
    margin-right: 10px;
}
.controls button {
    padding: 8px 12px;
    margin: 5px;
}
/* Stats */
#stats {
    margin-bottom: 20px;
}
#stats p {
    margin: 5px 0;
}
/* Chart canvas */
#chart {
    max-width: 100%;
    height: 300px;
}
/* Toast notification */
#toast {
    visibility: hidden;
    min-width: 200px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 4px;
    padding: 10px;
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.5s, visibility 0.5s;
}
#toast.show {
    visibility: visible;
    opacity: 0.9;
}
/* Modal window */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}
.modal-content {
    background-color: #fefefe;
    margin: 100px auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 400px;
    border-radius: 4px;
}
.modal-content h2 {
    margin-top: 0;
}
.modal-content label {
    display: block;
    margin: 10px 0;
}
.modal-content input {
    width: 100%;
    padding: 6px;
    box-sizing: border-box;
}
.modal-content button {
    padding: 8px 12px;
    margin: 10px 5px 0 0;
}
/* Responsive */
@media (max-width: 600px) {
    .controls input {
        width: 100%;
        margin-bottom: 10px;
    }
    .controls button {
        width: 100%;
        margin: 5px 0;
    }
    .modal-content {
        width: 90%;
        margin: 50px auto;
    }
}
</style>
<!-- Include Chart.js and html2pdf from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
<div class="controls">
    <input type="text" id="filterInput" placeholder="Filtrovat hráče...">
    <button id="addPlayerBtn">Přidat hráče</button>
    <button id="exportCsvBtn">Export CSV</button>
    <button id="exportPdfBtn">Export PDF</button>
</div>
<div class="pdf-wrapper">
    <h1 class="pdf-title">Statistiky hráčů</h1>
    <table id="players-table">
        <thead>
            <tr><th>Jméno</th><th>Skóre</th><th>Akce</th></tr>
        </thead>
        <tbody id="players-table-body">
        <!-- Dynamicky generované řádky -->
        </tbody>
    </table>
    <div id="stats">
        <p>Počet hráčů: <span id="stat-count"></span></p>
        <p>Průměrné skóre: <span id="stat-average"></span></p>
    </div>
    <canvas id="chart"></canvas>
</div>
<div id="toast"></div>
<!-- Modal pro přidání hráče -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h2>Přidat hráče</h2>
    <label>Jméno: <input type="text" id="newName"></label>
    <label>Skóre: <input type="number" id="newScore"></label>
    <button id="savePlayerBtn">Uložit</button>
    <button id="closeModalBtn">Zavřít</button>
  </div>
</div>
<script>
// Data structure
let players = [];

// Initialize from localStorage or default
function loadData() {
    const data = localStorage.getItem('playersData');
    if (data) {
        players = JSON.parse(data);
    } else {
        // Default sample players
        players = [
            {name: 'Alice', score: 10},
            {name: 'Bob', score: 15},
            {name: 'Charlie', score: 7}
        ];
    }
}

// Save to localStorage
function saveData() {
    localStorage.setItem('playersData', JSON.stringify(players));
    showToast('Data byla uložena');
}

// Debounce mechanism
let saveTimeout;
function scheduleSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(saveData, 500);
}

// Render table rows
function renderTable() {
    const tbody = document.getElementById('players-table-body');
    tbody.innerHTML = '';
    players.forEach((p, index) => {
        const tr = document.createElement('tr');
        // Name cell with input
        const tdName = document.createElement('td');
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.value = p.name;
        nameInput.dataset.index = index;
        nameInput.classList.add('name-input');
        nameInput.addEventListener('input', onInputChange);
        tdName.appendChild(nameInput);
        tr.appendChild(tdName);
        // Score cell with input
        const tdScore = document.createElement('td');
        const scoreInput = document.createElement('input');
        scoreInput.type = 'number';
        scoreInput.value = p.score;
        scoreInput.min = 0;
        scoreInput.dataset.index = index;
        scoreInput.classList.add('score-input');
        scoreInput.addEventListener('input', onInputChange);
        tdScore.appendChild(scoreInput);
        tr.appendChild(tdScore);
        // Action cell with delete button
        const tdAction = document.createElement('td');
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Smazat';
        delBtn.addEventListener('click', () => {
            removePlayer(index);
        });
        tdAction.appendChild(delBtn);
        tr.appendChild(tdAction);
        tbody.appendChild(tr);
    });
    updateStats();
    updateChart();
}

// Update stats display
function updateStats() {
    const count = players.length;
    const average = count ? (players.reduce((sum,p) => sum + (p.score ? parseFloat(p.score) : 0), 0) / count).toFixed(2) : 0;
    document.getElementById('stat-count').textContent = count;
    document.getElementById('stat-average').textContent = average;
}

// Chart.js chart
let chart;
function updateChart() {
    const ctx = document.getElementById('chart').getContext('2d');
    const labels = players.map(p => p.name);
    const data = players.map(p => Number(p.score));
    if (chart) {
        chart.data.labels = labels;
        chart.data.datasets[0].data = data;
        chart.update();
    } else {
        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Skóre hráčů',
                    data: data,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
}

// Input change handler
function onInputChange(e) {
    const index = e.target.dataset.index;
    if (e.target.classList.contains('name-input')) {
        players[index].name = e.target.value;
    } else if (e.target.classList.contains('score-input')) {
        players[index].score = e.target.value;
    }
    updateChart();
    updateStats();
    scheduleSave();
}

// Remove a player
function removePlayer(index) {
    players.splice(index, 1);
    renderTable();
    saveData();
    showToast('Hráč odstraněn');
}

// Filter players
document.getElementById('filterInput').addEventListener('input', function() {
    const filter = this.value.toLowerCase();
    document.querySelectorAll('#players-table-body tr').forEach(row => {
        const name = row.querySelector('.name-input').value.toLowerCase();
        row.style.display = name.includes(filter) ? '' : 'none';
    });
});

// Add player modal
document.getElementById('addPlayerBtn').addEventListener('click', () => {
    document.getElementById('modal').style.display = 'block';
});
document.getElementById('closeModalBtn').addEventListener('click', () => {
    document.getElementById('modal').style.display = 'none';
});
document.getElementById('savePlayerBtn').addEventListener('click', () => {
    const name = document.getElementById('newName').value.trim();
    const score = document.getElementById('newScore').value;
    if (name) {
        players.push({name: name, score: score || 0});
        renderTable();
        saveData();
        showToast('Hráč přidán');
        document.getElementById('modal').style.display = 'none';
        document.getElementById('newName').value = '';
        document.getElementById('newScore').value = '';
    }
});

// Export CSV
document.getElementById('exportCsvBtn').addEventListener('click', () => {
    let csvContent = 'Jméno,Skóre\n';
    players.forEach(p => {
        csvContent += p.name + ',' + p.score + '\n';
    });
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.setAttribute('href', url);
    link.setAttribute('download', 'players.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    showToast('CSV bylo exportováno');
});

// Export PDF
document.getElementById('exportPdfBtn').addEventListener('click', () => {
    const element = document.querySelector('.pdf-wrapper');
    html2pdf().from(element).save();
    showToast('PDF bylo exportováno');
});

// Toast function
function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'show';
    setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
}

// Init
loadData();
renderTable();

</script>
</body>
</html>
